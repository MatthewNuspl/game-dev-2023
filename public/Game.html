
<html>
    <head>
        <style>
            .flex-container {
                display: flex;
            }

            .flex-container > div {
                padding-left: 5;
                padding-top: -20;
                font-size: 20px;
            }

            .button1 {
                width: 250px;
                height: 100px
            }
        </style>
    </head>
    <body onload="start()">
        <h1 align="center">Marching Machines Tutorial</h1>
        <p>Click to Select character and move with WASD</p>
        <input type="button" id="save" value="Save State" onclick="saveState()"><input type="button" id="load" value="Load State" onclick="loadState()">
<br><br>
        <div id="block" style="font-size:20px">Get the Yellow guy in the bottom right to the yellow win indicated to the right.</div>
        <div id="block" style="font-size:20px">Other Machines block your path. Move them out of the way!</div>

        <br>
        <div id="YouWin"></div>
        <button class="button button1" style="display:none" id="button" onclick="next()">Continue to Full Game</button><br>

        <div id="flexbox" class="flex-container">
            <div>
                <canvas id="ctx" width="600" height="600" style="display:block; border:0px solid #000000; background-color: rgb(230, 230, 230)"></canvas>
            </div>
            <div>
                <h2 stlye="margin-top: 5px;" style="
                    margin-top: -7;
                    "> UP NEXT </h2>
                <canvas id="ctx2" width="144" height="144" style="border:0px solid #000000; background-color: rgb(230, 230, 230)"></canvas> 
                <div id="movecounter">Moves: 0 Total Moves: 0</div>
            </div>
            <div>
                <hr> How To Play <hr>
                
                <li>move the characters (colours with black dot in the middle) to the corresonding win tile shown on the right of the game</li>
                <li>the colours of the character and win tile must be the same </li>
                <li>the multi-coloured win tile can take any character</li>
                <li>Characters cannot go through each other so use them to block to your advantage</li>
                
                <hr>

                Control binds<hr>
                W - move character up <Br>
                A - move character left <br>
                S - move character down <br>
                D - move character right <br>
                Q - quick save <br>
                E - quick load <br>
                1 - selects the red character <br>
                2 - selects the yellow character <br>
                3 - selects the blue character <br>
                4 - selects the green character <br>
                RMB - selected a character that you clicked on <br>
            </div>
        </div>
        <div id="windiv"></div>
        <script>
            let rows = 16;
            let cols = 16;
            let size = 37.5
            let gridArray = []
            let winArray = []
            var c = document.getElementById("ctx")
            var ctx = c.getContext("2d")
            var c2 = document.getElementById("ctx2")
            var ctx2 = c2.getContext("2d")
            let width2 = document.getElementById("ctx2").width
            var getMousePos;
            var ranx;
            var rany;
            var SelectedCell;
            let keyA;
            let keyW;
            let keyS;
            let keyD;
            let MoveCounter = 0
            let MoveCounterTotal = 0
            let charcolor = 3
            let randomPickedCell;
            let winCount = 17
            let randomPick
            charsSaveR = localStorage.getItem('charSaveR')
            charsSaveY = localStorage.getItem('charSaveY')
            charsSaveB = localStorage.getItem('charSaveB')
            charsSaveG = localStorage.getItem('charSaveG')
            moveCountersave = localStorage.getItem('moveCounterSave')
            totalCountersave = localStorage.getItem('totalCounterSave')



            function next() {
                window.location.replace("https://cable-s.github.io/GameDev2022-23/public/Grid-Puzzle-grid.html");   

            }

            class Cell {
                constructor(x, y, c, ifChar, charR, charY, charB, charG, rainbow, posx, posy, leftWall, rightWall, upWall, downWall, redwin, greenwin, yellowwin, bluewin, id) {
                    this.x = x
                    this.y = y
                    this.c = c
                    this.ifChar = ifChar
                    this.charB = charB
                    this.charG = charG
                    this.charY = charY
                    this.charR = charR
                    this.rainbow = rainbow
                    this.posx = posx
                    this.posy = posy
                    this.leftWall = leftWall
                    this.rightWall = rightWall
                    this.upWall = upWall
                    this.downWall = downWall
                    this.greenwin = greenwin
                    this.redwin = redwin
                    this.bluewin = bluewin
                    this.yellowwin = yellowwin
                    this.id = id
                }
            }

            function start() {
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    createCell(j, i)
                    }
                }
                drawbackground()
                setChars()
                setWins()
                PickRandomWin()
                localStorage.clear()
                saveState()
                loadState()
            }

            function createCell(x, y) {
                x1 = x * size
                y1 = y * size//(x,        y,       color,ifchar, blue, Green, yelo,  red,  rainbow,posx,posy,left,right,up ,  down,  redW,  GreenW, yeloW, blueW, id )
                cell = new Cell(x * rows, y * cols, 255, false, false, false, false, false, false, x, y, false, false, false, false, false, false, false, false, 0)
                ctx.beginPath()
                ctx.strokeStyle = "black"
                ctx.strokeRect(x1, y1, x1 + size, y1 + size);
                ctx.closePath()
                gridArray.push(cell);

            }



            

            function PickRandomWin() {
                randomPick = 0
                    for (i = 0; i < winArray.length; i++) {
                        if (winArray.indexOf(winArray[i]) == randomPick) { 
                            randomPickedCell = winArray[i] 
                            switch(randomPickedCell.id) {
                                case 1:
                                    document.getElementById('windiv').innerHTML = "Red Vertical"
                                    winCount--
                                    index = winArray.indexOf(randomPickedCell);
                                    if (index > -1) {
                                    winArray.splice(index, 1);
                                    drawWinsIndicator()
                                    }
                                break;
                                case 2:
                                    document.getElementById('windiv').innerHTML = "Red Cross"
                                    winCount--
                                    index = winArray.indexOf(randomPickedCell);
                                    if (index > -1) {
                                    winArray.splice(index, 1);
                                    drawWinsIndicator()
                                    }
                                break;
                                case 3:
                                    document.getElementById('windiv').innerHTML = "Red Circle"
                                    winCount--
                                    index = winArray.indexOf(randomPickedCell);
                                    if (index > -1) {
                                    winArray.splice(index, 1);
                                    drawWinsIndicator()
                                    }
                                break;
                                case 4:
                                    document.getElementById('windiv').innerHTML = "Red Horizontal"
                                    winCount--
                                    index = winArray.indexOf(randomPickedCell);
                                    if (index > -1) {
                                    winArray.splice(index, 1);
                                    drawWinsIndicator()
                                    }
                                break;
                                case 5:
                                    document.getElementById('windiv').innerHTML = "Blue Vertical"
                                    winCount--
                                    index = winArray.indexOf(randomPickedCell);
                                    if (index > -1) {
                                    winArray.splice(index, 1);
                                    drawWinsIndicator()
                                    }
                                break;
                                case 6:
                                    document.getElementById('windiv').innerHTML = "Blue Cross"
                                    winCount--
                                    index = winArray.indexOf(randomPickedCell);
                                    if (index > -1) {
                                    winArray.splice(index, 1);
                                    drawWinsIndicator()
                                    }
                                break;
                                case 7:
                                    document.getElementById('windiv').innerHTML = "Blue Circle"
                                    winCount--
                                    index = winArray.indexOf(randomPickedCell);
                                    if (index > -1) {
                                    winArray.splice(index, 1);
                                    drawWinsIndicator()
                                    }
                                break;
                                case 8:
                                    document.getElementById('windiv').innerHTML = "Blue Horizontal"
                                    winCount--
                                    index = winArray.indexOf(randomPickedCell);
                                    if (index > -1) {
                                    winArray.splice(index, 1);
                                    drawWinsIndicator()
                                    }
                                break;
                                case 9:
                                    document.getElementById('windiv').innerHTML = "Green Vertical"
                                    winCount--
                                    index = winArray.indexOf(randomPickedCell);
                                    if (index > -1) {
                                    winArray.splice(index, 1);
                                    drawWinsIndicator()
                                    }
                                break;
                                case 10:
                                    document.getElementById('windiv').innerHTML = "Green Cross"
                                    winCount--
                                    index = winArray.indexOf(randomPickedCell);
                                    if (index > -1) {
                                    winArray.splice(index, 1);
                                    drawWinsIndicator()
                                    }
                                break;
                                case 11:
                                    document.getElementById('windiv').innerHTML = "Green Circle"
                                    winCount--
                                    index = winArray.indexOf(randomPickedCell);
                                    if (index > -1) {
                                    winArray.splice(index, 1);
                                    drawWinsIndicator()
                                    }
                                break;
                                case 12:
                                    document.getElementById('windiv').innerHTML = "Green Horizontal"
                                    winCount--
                                    index = winArray.indexOf(randomPickedCell);
                                    if (index > -1) {
                                    winArray.splice(index, 1);
                                    drawWinsIndicator()
                                    }
                                break;
                                case 13:
                                    document.getElementById('windiv').innerHTML = "Yellow Vertical"
                                    winCount--
                                    index = winArray.indexOf(randomPickedCell);
                                    if (index > -1) {
                                    winArray.splice(index, 1);
                                    drawWinsIndicator()
                                    }
                                break;
                                case 14:
                                    document.getElementById('windiv').innerHTML = "Yellow Cross"
                                    winCount--
                                    index = winArray.indexOf(randomPickedCell);
                                    if (index > -1) {
                                    winArray.splice(index, 1);
                                    drawWinsIndicator()
                                    }
                                break;
                                case 15:
                                    document.getElementById('windiv').innerHTML = "Yellow Circle"
                                    winCount--
                                    index = winArray.indexOf(randomPickedCell);
                                    if (index > -1) {
                                    winArray.splice(index, 1);
                                    drawWinsIndicator()
                                    }
                                break;
                                case 16:
                                    document.getElementById('windiv').innerHTML = "Yellow Horizontal"
                                    winCount--
                                    index = winArray.indexOf(randomPickedCell);
                                    if (index > -1) {
                                    winArray.splice(index, 1);
                                    drawWinsIndicator()
                                    }
                                break;
                                case 17:
                                    document.getElementById('windiv').innerHTML = "Rainbow"
                                    winCount--
                                    index = winArray.indexOf(randomPickedCell);
                                    if (index > -1) {
                                    winArray.splice(index, 1);
                                    drawWinsIndicator()
                                    }
                                break;
                            }
                        }
                    }
                }

            function drawWinsIndicator() {
                ctx2.clearRect(0, 0, 1000 ,1000)
                if (randomPickedCell.bluewin == true) {
                        ctx2.beginPath()
                        ctx2.strokeStyle = "blue"
                        ctx2.lineWidth = 10
                        ctx2.arc(width2 / 2, width2 / 2, 60, 0, 2 * Math.PI)
                        ctx2.stroke()
                        ctx2.closePath()
                        if (randomPickedCell.id % 4 == 0) {
                            ctx2.beginPath()
                            ctx2.strokeStyle = "black"
                            ctx2.lineWidth = 10
                            ctx2.moveTo(width2 / 2 + 60, width2 / 2)
                            ctx2.lineTo(width2 / 2 - 60, width2 / 2)
                            ctx2.stroke()
                            ctx2.closePath()
                        }
                        if (randomPickedCell.id % 4 == 1 && randomPickedCell.rainbow == false) {
                            ctx2.beginPath()
                            ctx2.strokeStyle = "black"
                            ctx2.lineWidth = 10
                            ctx2.moveTo(width2 / 2, width2 / 2 + 60)
                            ctx2.lineTo(width2 / 2, width2 / 2 - 60)
                            ctx2.stroke()
                            ctx2.closePath()
                        }
                        if (randomPickedCell.id % 4 == 2) {
                            ctx2.beginPath()
                            ctx2.strokeStyle = "black"
                            ctx2.lineWidth = 10
                            ctx2.moveTo(width2 / 2 + 60, width2 / 2)
                            ctx2.lineTo(width2 / 2 - 60, width2 / 2)
                            ctx2.stroke()
                            ctx2.closePath()
                            ctx2.beginPath()
                            ctx2.strokeStyle = "black"
                            ctx2.lineWidth = 10
                            ctx2.moveTo(width2 / 2, width2 / 2 + 60)
                            ctx2.lineTo(width2 / 2, width2 / 2 - 60)
                            ctx2.stroke()
                            ctx2.closePath()
                        }
                    }
                    if (randomPickedCell.greenwin == true) {
                        ctx2.beginPath()
                        ctx2.strokeStyle = "green"
                        ctx2.lineWidth = 10
                        ctx2.arc(width2 / 2, width2 / 2, 60, 0, 2 * Math.PI)
                        ctx2.stroke()
                        ctx2.closePath()
                        if (randomPickedCell.id % 4 == 0) {
                            ctx2.beginPath()
                            ctx2.strokeStyle = "black"
                            ctx2.lineWidth = 10
                            ctx2.moveTo(width2 / 2 + 60, width2 / 2)
                            ctx2.lineTo(width2 / 2 - 60, width2 / 2)
                            ctx2.stroke()
                            ctx2.closePath()
                        }
                        if (randomPickedCell.id % 4 == 1 && randomPickedCell.rainbow == false) {
                            ctx2.beginPath()
                            ctx2.strokeStyle = "black"
                            ctx2.lineWidth = 10
                            ctx2.moveTo(width2 / 2, width2 / 2 + 60)
                            ctx2.lineTo(width2 / 2, width2 / 2 - 60)
                            ctx2.stroke()
                            ctx2.closePath()
                        }
                        if (randomPickedCell.id % 4 == 2) {
                            ctx2.beginPath()
                            ctx2.strokeStyle = "black"
                            ctx2.lineWidth = 10
                            ctx2.moveTo(width2 / 2 + 60, width2 / 2)
                            ctx2.lineTo(width2 / 2 - 60, width2 / 2)
                            ctx2.stroke()
                            ctx2.closePath()
                            ctx2.beginPath()
                            ctx2.strokeStyle = "black"
                            ctx2.lineWidth = 10
                            ctx2.moveTo(width2 / 2, width2 / 2 + 60)
                            ctx2.lineTo(width2 / 2, width2 / 2 - 60)
                            ctx2.stroke()
                            ctx2.closePath()
                        }
                    }
                    if (randomPickedCell.yellowwin == true) {
                        ctx2.beginPath()
                        ctx2.strokeStyle = "yellow"
                        ctx2.lineWidth = 10
                        ctx2.arc(width2 / 2, width2 / 2, 60, 0, 2 * Math.PI)
                        ctx2.stroke()
                        ctx2.closePath()
                        if (randomPickedCell.id % 4 == 0) {
                            ctx2.beginPath()
                            ctx2.strokeStyle = "black"
                            ctx2.lineWidth = 10
                            ctx2.moveTo(width2 / 2 + 60, width2 / 2)
                            ctx2.lineTo(width2 / 2 - 60, width2 / 2)
                            ctx2.stroke()
                            ctx2.closePath()
                        }
                        if (randomPickedCell.id % 4 == 1 && randomPickedCell.rainbow == false) {
                            ctx2.beginPath()
                            ctx2.strokeStyle = "black"
                            ctx2.lineWidth = 10
                            ctx2.moveTo(width2 / 2, width2 / 2 + 60)
                            ctx2.lineTo(width2 / 2, width2 / 2 - 60)
                            ctx2.stroke()
                            ctx2.closePath()
                        }
                        if (randomPickedCell.id % 4 == 2) {
                            ctx2.beginPath()
                            ctx2.strokeStyle = "black"
                            ctx2.lineWidth = 10
                            ctx2.moveTo(width2 / 2 + 60, width2 / 2)
                            ctx2.lineTo(width2 / 2 - 60, width2 / 2)
                            ctx2.stroke()
                            ctx2.closePath()
                            ctx2.beginPath()
                            ctx2.strokeStyle = "black"
                            ctx2.lineWidth = 10
                            ctx2.moveTo(width2 / 2, width2 / 2 + 60)
                            ctx2.lineTo(width2 / 2, width2 / 2 - 60)
                            ctx2.stroke()
                            ctx2.closePath()
                        }
                    }
                    if (randomPickedCell.redwin == true) {
                        ctx2.beginPath()
                        ctx2.strokeStyle = "red"
                        ctx2.lineWidth = 10
                        ctx2.arc(width2 / 2, width2 / 2, 60, 0, 2 * Math.PI)
                        ctx2.stroke()
                        ctx2.closePath()
                        if (randomPickedCell.id % 4 == 0) {
                            ctx2.beginPath()
                            ctx2.strokeStyle = "black"
                            ctx2.lineWidth = 10
                            ctx2.moveTo(width2 / 2 + 60, width2 / 2)
                            ctx2.lineTo(width2 / 2 - 60, width2 / 2)
                            ctx2.stroke()
                            ctx2.closePath()
                        }
                        if (randomPickedCell.id % 4 == 1  && randomPickedCell.rainbow == false) {
                            ctx2.beginPath()
                            ctx2.strokeStyle = "black"
                            ctx2.lineWidth = 10
                            ctx2.moveTo(width2 / 2, width2 / 2 + 60)
                            ctx2.lineTo(width2 / 2, width2 / 2 - 60)
                            ctx2.stroke()
                            ctx2.closePath()
                        }
                        if (randomPickedCell.id % 4 == 2) {
                            ctx2.beginPath()
                            ctx2.strokeStyle = "black"
                            ctx2.lineWidth = 10
                            ctx2.moveTo(width2 / 2 + 60, width2 / 2)
                            ctx2.lineTo(width2 / 2 - 60, width2 / 2)
                            ctx2.stroke()
                            ctx2.closePath()
                            ctx2.beginPath()
                            ctx2.strokeStyle = "black"
                            ctx2.lineWidth = 10
                            ctx2.moveTo(width2 / 2, width2 / 2 + 60)
                            ctx2.lineTo(width2 / 2, width2 / 2 - 60)
                            ctx2.stroke()
                            ctx2.closePath()
                        }
                    }
                    if (randomPickedCell.rainbow == true) {
                        ctx2.beginPath()
                        ctx2.strokeStyle = "red"
                        ctx2.lineWidth = 10
                        ctx2.arc(width2 / 2, width2 / 2, 60, 0, Math.PI / 2)
                        ctx2.stroke()
                        ctx2.closePath()
                        ctx2.beginPath()
                        ctx2.strokeStyle = "green"
                        ctx2.lineWidth = 10
                        ctx2.arc(width2 / 2, width2 / 2, 60, Math.PI / 2, Math.PI )
                        ctx2.stroke()
                        ctx2.closePath()
                        ctx2.beginPath()
                        ctx2.strokeStyle = "blue"
                        ctx2.lineWidth = 10
                        ctx2.arc(width2 / 2, width2 / 2, 60, Math.PI, 3 * Math.PI / 2)
                        ctx2.stroke()
                        ctx2.closePath()
                        ctx2.beginPath()
                        ctx2.strokeStyle = "yellow"
                        ctx2.lineWidth = 10
                        ctx2.arc(width2 / 2, width2 / 2, 60, 3 * Math.PI / 2, 2 * Math.PI)
                        ctx2.stroke()
                        ctx2.closePath()
                    }
            }

            function setWins() {
                gridArray[1].yellowwin = true
                
                gridArray[1].id = 1 //r
               
                winArray.push(gridArray[1],)
                            




                drawwins()
            }
            function drawwins() {
                for (i = 0; i < gridArray.length; i++) {
                    if (gridArray[i].bluewin == true) {
                        ctx.beginPath()
                        ctx.strokeStyle = "blue"
                        ctx.arc(gridArray[i].x * size / rows + size / 2, gridArray[i].y * size / rows + size / 2, 10, 0, 2 * Math.PI)
                        ctx.stroke()
                        ctx.closePath()
                        if (gridArray[i].id % 4 == 0) {
                            ctx.beginPath()
                            ctx.strokeStyle = "black"
                            ctx.moveTo((gridArray[i].x * size / rows + size / 2) - 10 , (gridArray[i].y * size / rows + size / 2))
                            ctx.lineTo((gridArray[i].x * size / rows + size / 2) + 10 , (gridArray[i].y * size / rows + size / 2))
                            ctx.stroke()
                            ctx.closePath()
                        }
                        if (gridArray[i].id % 4 == 1 && gridArray[i].rainbow == false) {
                            ctx.beginPath()
                            ctx.strokeStyle = "black"
                            ctx.moveTo((gridArray[i].x * size / rows + size / 2), (gridArray[i].y * size / rows + size / 2) - 10)
                            ctx.lineTo((gridArray[i].x * size / rows + size / 2), (gridArray[i].y * size / rows + size / 2) + 10)
                            ctx.stroke()
                            ctx.closePath()
                        }
                        if (gridArray[i].id % 4 == 2) {
                            ctx.beginPath()
                            ctx.strokeStyle = "black"
                            ctx.moveTo((gridArray[i].x * size / rows + size / 2), (gridArray[i].y * size / rows + size / 2) - 10)
                            ctx.lineTo((gridArray[i].x * size / rows + size / 2), (gridArray[i].y * size / rows + size / 2) + 10)
                            ctx.stroke()
                            ctx.closePath()
                            ctx.beginPath()
                            ctx.strokeStyle = "black"
                            ctx.moveTo((gridArray[i].x * size / rows + size / 2) + 10, (gridArray[i].y * size / rows + size / 2))
                            ctx.lineTo((gridArray[i].x * size / rows + size / 2) - 10, (gridArray[i].y * size / rows + size / 2))
                            ctx.stroke()
                            ctx.closePath()
                        }
                    }
                    if (gridArray[i].greenwin == true) {
                        ctx.beginPath()
                        ctx.strokeStyle = "green"
                        ctx.arc(gridArray[i].x * size / rows + size / 2, gridArray[i].y * size / rows + size / 2, 10, 0, 2 * Math.PI)
                        ctx.stroke()
                        ctx.closePath()
                        if (gridArray[i].id % 4 == 0) {
                            ctx.beginPath()
                            ctx.strokeStyle = "black"
                            ctx.moveTo((gridArray[i].x * size / rows + size / 2) - 10 , (gridArray[i].y * size / rows + size / 2))
                            ctx.lineTo((gridArray[i].x * size / rows + size / 2) + 10 , (gridArray[i].y * size / rows + size / 2))
                            ctx.stroke()
                            ctx.closePath()
                        }
                        if (gridArray[i].id % 4 == 1 && gridArray[i].rainbow == false) {
                            ctx.beginPath()
                            ctx.strokeStyle = "black"
                            ctx.moveTo((gridArray[i].x * size / rows + size / 2), (gridArray[i].y * size / rows + size / 2) - 10)
                            ctx.lineTo((gridArray[i].x * size / rows + size / 2), (gridArray[i].y * size / rows + size / 2) + 10)
                            ctx.stroke()
                            ctx.closePath()
                        }
                        if (gridArray[i].id % 4 == 2) {
                            ctx.beginPath()
                            ctx.strokeStyle = "black"
                            ctx.moveTo((gridArray[i].x * size / rows + size / 2), (gridArray[i].y * size / rows + size / 2) - 10)
                            ctx.lineTo((gridArray[i].x * size / rows + size / 2), (gridArray[i].y * size / rows + size / 2) + 10)
                            ctx.stroke()
                            ctx.closePath()
                            ctx.beginPath()
                            ctx.strokeStyle = "black"
                            ctx.moveTo((gridArray[i].x * size / rows + size / 2) + 10, (gridArray[i].y * size / rows + size / 2))
                            ctx.lineTo((gridArray[i].x * size / rows + size / 2) - 10, (gridArray[i].y * size / rows + size / 2))
                            ctx.stroke()
                            ctx.closePath()
                        }
                    }
                    if (gridArray[i].yellowwin == true) {
                        ctx.beginPath()
                        ctx.strokeStyle = "yellow"
                        ctx.arc(gridArray[i].x * size / rows + size / 2, gridArray[i].y * size / rows + size / 2, 10, 0, 2 * Math.PI)
                        ctx.stroke()
                        ctx.closePath()
                        if (gridArray[i].id % 4 == 0) {
                            ctx.beginPath()
                            ctx.strokeStyle = "black"
                            ctx.moveTo((gridArray[i].x * size / rows + size / 2) - 10 , (gridArray[i].y * size / rows + size / 2))
                            ctx.lineTo((gridArray[i].x * size / rows + size / 2) + 10 , (gridArray[i].y * size / rows + size / 2))
                            ctx.stroke()
                            ctx.closePath()
                        }
                        if (gridArray[i].id % 4 == 1 && gridArray[i].rainbow == false) {
                            ctx.beginPath()
                            ctx.strokeStyle = "black"
                            ctx.moveTo((gridArray[i].x * size / rows + size / 2), (gridArray[i].y * size / rows + size / 2) - 10)
                            ctx.lineTo((gridArray[i].x * size / rows + size / 2), (gridArray[i].y * size / rows + size / 2) + 10)
                            ctx.stroke()
                            ctx.closePath()
                        }
                        if (gridArray[i].id % 4 == 2) {
                            ctx.beginPath()
                            ctx.strokeStyle = "black"
                            ctx.moveTo((gridArray[i].x * size / rows + size / 2), (gridArray[i].y * size / rows + size / 2) - 10)
                            ctx.lineTo((gridArray[i].x * size / rows + size / 2), (gridArray[i].y * size / rows + size / 2) + 10)
                            ctx.stroke()
                            ctx.closePath()
                            ctx.beginPath()
                            ctx.strokeStyle = "black"
                            ctx.moveTo((gridArray[i].x * size / rows + size / 2) + 10, (gridArray[i].y * size / rows + size / 2))
                            ctx.lineTo((gridArray[i].x * size / rows + size / 2) - 10, (gridArray[i].y * size / rows + size / 2))
                            ctx.stroke()
                            ctx.closePath()
                        }
                    }
                    if (gridArray[i].redwin == true) {
                        ctx.beginPath()
                        ctx.strokeStyle = "red"
                        ctx.arc(gridArray[i].x * size / rows + size / 2, gridArray[i].y * size / rows + size / 2, 10, 0, 2 * Math.PI)
                        ctx.stroke()
                        ctx.closePath()
                        if (gridArray[i].id % 4 == 0) {
                            ctx.beginPath()
                            ctx.strokeStyle = "black"
                            ctx.moveTo((gridArray[i].x * size / rows + size / 2) - 10 , (gridArray[i].y * size / rows + size / 2))
                            ctx.lineTo((gridArray[i].x * size / rows + size / 2) + 10 , (gridArray[i].y * size / rows + size / 2))
                            ctx.stroke()
                            ctx.closePath()
                        }
                        if (gridArray[i].id % 4 == 1 && gridArray[i].rainbow == false) {
                            ctx.beginPath()
                            ctx.strokeStyle = "black"
                            ctx.moveTo((gridArray[i].x * size / rows + size / 2), (gridArray[i].y * size / rows + size / 2) - 10)
                            ctx.lineTo((gridArray[i].x * size / rows + size / 2), (gridArray[i].y * size / rows + size / 2) + 10)
                            ctx.stroke()
                            ctx.closePath()
                        }
                        if (gridArray[i].id % 4 == 2) {
                            ctx.beginPath()
                            ctx.strokeStyle = "black"
                            ctx.moveTo((gridArray[i].x * size / rows + size / 2), (gridArray[i].y * size / rows + size / 2) - 10)
                            ctx.lineTo((gridArray[i].x * size / rows + size / 2), (gridArray[i].y * size / rows + size / 2) + 10)
                            ctx.stroke()
                            ctx.closePath()
                            ctx.beginPath()
                            ctx.strokeStyle = "black"
                            ctx.moveTo((gridArray[i].x * size / rows + size / 2) + 10, (gridArray[i].y * size / rows + size / 2))
                            ctx.lineTo((gridArray[i].x * size / rows + size / 2) - 10, (gridArray[i].y * size / rows + size / 2))
                            ctx.stroke()
                            ctx.closePath()
                        }
                    }
                    if (gridArray[i].rainbow == true) {
                        ctx.beginPath()
                        ctx.strokeStyle = "red"
                        ctx.arc(gridArray[i].x * size / rows + size / 2, gridArray[i].y * size / rows + size / 2, 10, 0, Math.PI / 2)
                        ctx.stroke()
                        ctx.closePath()
                        ctx.beginPath()
                        ctx.strokeStyle = "green"
                        ctx.arc(gridArray[i].x * size / rows + size / 2, gridArray[i].y * size / rows + size / 2, 10, Math.PI / 2, Math.PI )
                        ctx.stroke()
                        ctx.closePath()
                        ctx.beginPath()
                        ctx.strokeStyle = "blue"
                        ctx.arc(gridArray[i].x * size / rows + size / 2, gridArray[i].y * size / rows + size / 2, 10, Math.PI, 3 * Math.PI / 2)
                        ctx.stroke()
                        ctx.closePath()
                        ctx.beginPath()
                        ctx.strokeStyle = "yellow"
                        ctx.arc(gridArray[i].x * size / rows + size / 2, gridArray[i].y * size / rows + size / 2, 10, 3 * Math.PI / 2, 2 * Math.PI)
                        ctx.stroke()
                        ctx.closePath()
                    }
                    
                }

            }

            function setChars() {

                gridArray[0].ifChar = true;
                gridArray[0].charcolor = 0;

                gridArray[2].ifChar = true;
                gridArray[2].charcolor = 2;

                gridArray[17].ifChar = true
                gridArray[17].charcolor = 1

                gridArray[253].ifChar = true
                gridArray[253].charcolor = 3

                
                for (let k = 0; k < gridArray.length; k++) {
                    if (gridArray[k].ifChar == true && charcolor == 3) {
                        gridArray[k].charR = true
                        charcolor = 2
                    }
                    else if (gridArray[k].ifChar == true && charcolor == 2) {
                        gridArray[k].charB = true
                        charcolor = 1
                    }
                    else if (gridArray[k].ifChar == true && charcolor == 1) {
                        gridArray[k].charG = true
                        charcolor = 0
                    }
                    else if (gridArray[k].ifChar == true && charcolor == 0) {
                        gridArray[k].charY = true
                    }
                }                

            
            drawChar()
            }
            function drawChar() {
                for (i = 0; i < gridArray.length; i++) {
                    if (gridArray[i].ifChar == true && gridArray[i].charB == true ) {
                        ctx.beginPath()
                        ctx.strokeStyle = "blue"
                        ctx.arc((gridArray[i].x * size / rows) + size / 2, (gridArray[i].y * size / cols) + size / 2, 5, 0, 2 * Math.PI)
                        ctx.stroke()
                        ctx.closePath()
                        ctx.beginPath()
                        ctx.strokeStyle = "black"
                        ctx.arc((gridArray[i].x * size / rows) + size / 2, (gridArray[i].y * size / cols) + size / 2, 1.5, 0, 2 * Math.PI)
                        ctx.stroke()
                        ctx.closePath()
                    }
                    if (gridArray[i].ifChar == true && gridArray[i].charG == true ) {
                        ctx.beginPath()
                        ctx.strokeStyle = "Green"
                        ctx.arc((gridArray[i].x * size / rows) + size / 2, (gridArray[i].y * size / cols) + size / 2, 5, 0, 2 * Math.PI)
                        ctx.stroke()
                        ctx.closePath()
                        ctx.beginPath()
                        ctx.strokeStyle = "black"
                        ctx.arc((gridArray[i].x * size / rows) + size / 2, (gridArray[i].y * size / cols) + size / 2, 1.5, 0, 2 * Math.PI)
                        ctx.stroke()
                        ctx.closePath()
                    }
                    if (gridArray[i].ifChar == true && gridArray[i].charR == true ) {
                        ctx.beginPath()
                        ctx.strokeStyle = "red"
                        ctx.arc((gridArray[i].x * size / rows) + size / 2, (gridArray[i].y * size / cols) + size / 2, 5, 0, 2 * Math.PI)
                        ctx.stroke()
                        ctx.closePath()
                        ctx.beginPath()
                        ctx.strokeStyle = "black"
                        ctx.arc((gridArray[i].x * size / rows) + size / 2, (gridArray[i].y * size / cols) + size / 2, 1.5, 0, 2 * Math.PI)
                        ctx.stroke()
                        ctx.closePath()
                    }
                    if (gridArray[i].ifChar == true && gridArray[i].charY == true ) {
                        ctx.beginPath()
                        ctx.strokeStyle = "Yellow"
                        ctx.arc((gridArray[i].x * size / rows) + size / 2, (gridArray[i].y * size / cols) + size / 2, 5, 0, 2 * Math.PI)
                        ctx.stroke()
                        ctx.closePath()
                        ctx.beginPath()
                        ctx.strokeStyle = "black"
                        ctx.arc((gridArray[i].x * size / rows) + size / 2, (gridArray[i].y * size / cols) + size / 2, 1.5, 0, 2 * Math.PI)
                        ctx.stroke()
                        ctx.closePath()
                    }
                }
            }
            function drawbackground() {
                for (i = 0; i < gridArray.length; i++) {
                if (gridArray[i].ifChar == false) {
                        ctx.beginPath();
                        ctx.fillStyle = "#c4b597" //'rgb(' + 230+ ',' + 230 + ',' +  230 + ')'
                        ctx.fillRect((gridArray[i].x * size / rows) + 1,
                                    (gridArray[i].y * size / cols) + 1, 
                                    35, 
                                    35);
                        ctx.stroke();
                        ctx.closePath()
                    }
                }
            }

            function checkWin() {
                for (i = 0; i < gridArray.length; i++) {
                    if (SelectedCell.x == randomPickedCell.x && SelectedCell.y == randomPickedCell.y) {
                        if (randomPickedCell.redwin == true && SelectedCell.charR == true 
                        || randomPickedCell.greenwin == true && SelectedCell.charG == true 
                        || randomPickedCell.bluewin == true && SelectedCell.charB == true 
                        || randomPickedCell.yellowwin == true && SelectedCell.charY == true ) {
                            PickRandomWin()
                            MoveCounter = -1
                            saveState()
                            if (winArray.length == 0) {
                                document.getElementById('ctx').style.display = "none"
                                document.getElementById('flexbox').style.display = "none"
                                document.getElementById('YouWin').innerHTML = "You Won in " + MoveCounterTotal + " Moves"
                                document.getElementById('YouWin').style.fontSize = 60 + "px"
                                document.getElementById('YouWin').style.display = "block"
                                document.getElementById('movecounter').innerHTML = " "
                                document.getElementById('windiv').style.display = "none"
                                document.getElementById('button').style.display = "block"

                            }
                        }
                    }
                }
            }

            function saveState() {
                for (i = 0; i < gridArray.length; i++) {
                    if (gridArray[i].ifChar == true && gridArray[i].charR == true) {
                        localStorage.setItem('charSaveR', JSON.stringify(gridArray[i]))
                    }
                    if (gridArray[i].ifChar == true && gridArray[i].charY == true) {
                        localStorage.setItem('charSaveY', JSON.stringify(gridArray[i]))
                    }
                    if (gridArray[i].ifChar == true && gridArray[i].charB == true) {
                        localStorage.setItem('charSaveB', JSON.stringify(gridArray[i]))
                    }
                    if (gridArray[i].ifChar == true && gridArray[i].charG == true) {
                        localStorage.setItem('charSaveG', JSON.stringify(gridArray[i]))
                    }
                }
                localStorage.setItem('moveCounterSave', MoveCounter)
                localStorage.setItem('totalCounterSave', MoveCounterTotal)
                moveCountersave = localStorage.getItem('moveCounterSave')
                totalCountersave = localStorage.getItem('totalCounterSave')
                charsSaveR = localStorage.getItem('charSaveR')
                charsSaveY = localStorage.getItem('charSaveY')
                charsSaveB = localStorage.getItem('charSaveB')
                charsSaveG = localStorage.getItem('charSaveG')
            }
            function loadState() {
                for (i = 0; i < gridArray.length; i++) {
                    gridArray[i].ifChar = false
                    gridArray[i].charB = false
                    gridArray[i].charY = false
                    gridArray[i].charR = false
                    gridArray[i].charG = false
                }
                let tempR = JSON.parse(charsSaveR)
                let tempB = JSON.parse(charsSaveB)
                let tempY = JSON.parse(charsSaveY)
                let tempG = JSON.parse(charsSaveG)
                for (j = 0; j < gridArray.length; j++) {
                    if (gridArray[j].x == tempR.x && gridArray[j].y == tempR.y) {
                        gridArray[j].ifChar = true
                        gridArray[j].charR = true
                    }
                    if (gridArray[j].x == tempB.x && gridArray[j].y == tempB.y) {
                        gridArray[j].ifChar = true
                        gridArray[j].charB = true
                    }
                    if (gridArray[j].x == tempY.x && gridArray[j].y == tempY.y) {
                        gridArray[j].ifChar = true
                        gridArray[j].charY = true
                    }
                    if (gridArray[j].x == tempG.x && gridArray[j].y == tempG.y) {
                        gridArray[j].ifChar = true
                        gridArray[j].charG = true
                    }
                }
                MoveCounter = moveCountersave
                MoveCounterTotal = totalCountersave
                document.getElementById('movecounter').innerHTML = "Moves: " + MoveCounter + "  Total Moves: " + MoveCounterTotal;
                drawbackground()
                drawwins()
                drawChar();
            }

            function MovementUp() {
                for (j = 0; j < 15; j++) {
                    i = (SelectedCell.posy * 16) + SelectedCell.posx
                    if (SelectedCell.y > 0 && gridArray[i - cols].downWall == false) {
                        if (gridArray[i - cols].ifChar == false){
                            if (SelectedCell.charB == true) {
                                gridArray[i - cols].charB = true
                            }
                            if (SelectedCell.charG == true) {
                                gridArray[i - cols].charG = true
                            }
                            if (SelectedCell.charR == true) {
                                gridArray[i - cols].charR = true
                            }
                            if (SelectedCell.charY == true) {
                                gridArray[i - cols].charY = true
                            }
                            SelectedCell.charB = false
                            SelectedCell.charG = false
                            SelectedCell.charR = false
                            SelectedCell.charY = false
                            SelectedCell.ifChar = false
                            gridArray[i - cols].ifChar = true
                            SelectedCell = gridArray[i - cols]
                            drawbackground()
                            drawwins()
                            drawChar();
                            checkWin()
                        }  
                    }
                }
                MoveCounter++
                MoveCounterTotal++
                document.getElementById('movecounter').innerHTML = "Moves: " + MoveCounter + "  Total Moves: " + MoveCounterTotal;
            }
            function MovementDown() {
                for (j = 0; j < 15; j++) {
                    i = (SelectedCell.posy * 16) + SelectedCell.posx
                    if (SelectedCell.y < 240 && gridArray[i + cols].upWall == false) {
                        if (gridArray[i + cols].ifChar == false){
                            if (SelectedCell.charB == true) {
                                gridArray[i + cols].charB = true
                            }
                            if (SelectedCell.charG == true) {
                                gridArray[i + cols].charG = true
                            }
                            if (SelectedCell.charR == true) {
                                gridArray[i + cols].charR = true
                            }
                            if (SelectedCell.charY == true) {
                                gridArray[i + cols].charY = true
                            }
                            SelectedCell.charB = false
                            SelectedCell.charG = false
                            SelectedCell.charR = false
                            SelectedCell.charY = false
                            SelectedCell.ifChar = false
                            gridArray[i + cols].ifChar = true
                            SelectedCell = gridArray[i + cols]
                            drawbackground()
                            drawwins()
                            drawChar();
                            checkWin()

                        }  
                    }
                }
                MoveCounter++
                MoveCounterTotal++
                document.getElementById('movecounter').innerHTML = "Moves: " + MoveCounter + "  Total Moves: " + MoveCounterTotal;
            }
            function MovementRight() {
                for (j = 0; j < 15; j++) {
                    i = (SelectedCell.posy * 16) + SelectedCell.posx
                    if (SelectedCell.x > 0 && gridArray[i - 1].rightWall == false) {
                        if (gridArray[i - 1].ifChar == false){
                            if (SelectedCell.charB == true) {
                                gridArray[i - 1].charB = true
                            }
                            if (SelectedCell.charG == true) {
                                gridArray[i - 1].charG = true 
                            }
                            if (SelectedCell.charR == true) {
                                gridArray[i - 1].charR = true
                            }
                            if (SelectedCell.charY == true) {
                                gridArray[i - 1].charY = true
                            }
                            SelectedCell.charB = false
                            SelectedCell.charG = false
                            SelectedCell.charR = false
                            SelectedCell.charY = false
                            SelectedCell.ifChar = false
                            gridArray[i - 1].ifChar = true
                            SelectedCell = gridArray[i - 1]
                            drawbackground()
                            drawwins()
                            drawChar();
                            checkWin()

                        }  
                    }
                }
                MoveCounter++
                MoveCounterTotal++
                document.getElementById('movecounter').innerHTML = "Moves: " + MoveCounter + "  Total Moves: " + MoveCounterTotal;
            }
            function MovementLeft() {
                for (j = 0; j < 15; j++) {
                    i = (SelectedCell.posy * 16) + SelectedCell.posx
                    if (SelectedCell.x < 240 && gridArray[i + 1].leftWall == false) {
                        if (gridArray[i + 1].ifChar == false){
                            if (SelectedCell.charB == true) {
                                gridArray[i + 1].charB = true
                            }
                            if (SelectedCell.charG == true) {
                                gridArray[i + 1].charG = true
                            }
                            if (SelectedCell.charR == true) {
                                gridArray[i + 1].charR = true
                            }
                            if (SelectedCell.charY == true) {
                                gridArray[i + 1].charY = true
                            }
                            SelectedCell.charB = false
                            SelectedCell.charG = false
                            SelectedCell.charR = false
                            SelectedCell.charY = false  
                            SelectedCell.ifChar = false
                            gridArray[i + 1].ifChar = true
                            SelectedCell = gridArray[i + 1]
                            drawbackground()
                            drawwins()
                            drawChar();
                            checkWin()

                        }  
                    }
                }
                MoveCounter++
                MoveCounterTotal++
                document.getElementById('movecounter').innerHTML = "Moves: " + MoveCounter + "  Total Moves: " + MoveCounterTotal;            
            }
            function mapRange(value, a, b, c, d) {
                value = (value - a) / (b - a);
                return c + value * (d - c);

            }

            function mousePos(canvas, event) {
                return {
                x: mapRange(event.offsetX, 0, 600, 0, 256),
                y: mapRange(event.offsetY, 0, 600, 0, 256)
                }
            }

            function insidePos(pos, button1) {
                //console.log(button1.x *2.5)
            return pos.x > button1.x &&
                pos.x < button1.x+ 35 && 
                pos.y < button1.y + 35 && 
                pos.y > button1.y;
            }

            c.addEventListener('click', function (e) {
                for (i = 0; i < gridArray.length; i++) {  
                var getMousePos = mousePos(c, e)
                //console.log(getMousePos)
                    if (insidePos(getMousePos,gridArray[i])) {
                        if (gridArray[i].ifChar == true) {
                        SelectedCell = gridArray[i]
                        //console.log(SelectedCell)
                        }
                    }
                }
            })

            window.addEventListener("keydown", onKeyDown, false);
            function onKeyDown(event){
            var keyCode = event.keyCode;
            switch(keyCode){
                case 68:  //d
                    MovementLeft()
                break;
                case 83:  //s
                    MovementDown()
                break;
                case 65:  //a
                    MovementRight()
                break;
                case 87: //w
                    MovementUp()
                break;
                case 49:
                    for (i = 0; i < gridArray.length; i++) {
                        if (gridArray[i].charR == true) {
                            SelectedCell = gridArray[i]
                        }
                    }
                break;
                case 50:
                    for (i = 0; i < gridArray.length; i++) {
                        if (gridArray[i].charY == true) {
                            SelectedCell = gridArray[i]
                        }
                    }
                break;
                case 51:
                    for (i = 0; i < gridArray.length; i++) {
                        if (gridArray[i].charB == true) {
                            SelectedCell = gridArray[i]
                        }
                    }
                break;
                case 52:
                    for (i = 0; i < gridArray.length; i++) {
                        if (gridArray[i].charG == true) {
                            SelectedCell = gridArray[i]
                        }
                    }
                break;
                case 81:
                    saveState()
                break;
                case 69:
                    loadState()
                break;
            }
            }
        </script>
    </body>
</html>
